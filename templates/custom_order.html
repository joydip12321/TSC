{% extends "image.html" %} 
{% block first %}

<section class="custom_order_section layout_padding-bottom py-10">
    <div class="container mx-auto px-4">
        <div class="heading_container heading_center mb-8">
            <h2 class="text-3xl font-bold text-gray-800 text-center">
                Custom Order
            </h2>
        </div>

        <form id="order-form" method="POST" action="{% url 'custom_order' %}" class="max-w-lg mx-auto bg-white p-6 rounded-lg shadow-lg">
            {% csrf_token %}

            <!-- Input fields for adding items -->
            <div class="flex space-x-2 mb-4">
                <input type="text" id="item-name" placeholder="Item Name" class="border rounded w-2/3 p-2" />
                <input type="number" id="item-quantity" placeholder="Qty" min="1" class="border rounded w-1/3 p-2" />
            </div>

            <!-- Add Item Button -->
            <div class="flex justify-end mb-4">
                <button type="button" id="add-item" class="bg-blue-500 text-white px-3 py-1.5 rounded-md text-sm hover:bg-blue-600 transition duration-300">
                    + Add Item
                </button>
            </div>

            <!-- Order Table (Initially Hidden) -->
            <table class="w-full border border-gray-300 rounded-lg overflow-hidden mb-4 hidden" id="order-table">
                <thead class="bg-gray-100 text-gray-800">
                    <tr>
                        <th class="px-1 py-1">SL</th>
                        <th class="px-1 py-1">Item Name</th>
                        <th class="px-1 py-1">Quantity</th>
                        <th class="px-1 py-1">Action</th>
                    </tr>
                </thead>
                <tbody id="order-items">
                    <!-- Items will be dynamically inserted here -->
                </tbody>
            </table>

            <!-- Hidden input for storing items before submission -->
            <input type="hidden" name="order_items" id="order-items-input" />

            <!-- Location -->
            <div class="mb-4">
                <label for="location" class="block text-sm font-medium text-gray-700">Location:</label>
                <input type="text" id="location" name="location" class="border rounded w-full p-1 mt-1" required>
            </div>

            <!-- Order Time -->
            <div class="mb-4">
                <label for="order_time" class="block text-sm font-medium text-gray-700">Order Time:</label>
                <input type="datetime-local" id="order_time" name="order_time" class="border rounded w-full p-2 mt-1" required>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-center">
                <button type="submit" id="submit-order" class="w-1/3 bg-green-500 text-white font-bold py-2 rounded-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-300">
                    Submit Order
                </button>
            </div>
        </form>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let orderItems = [];
        const orderTable = document.getElementById("order-table");
        const orderItemsInput = document.getElementById("order-items-input");

        document.getElementById("add-item").addEventListener("click", function () {
            const itemName = document.getElementById("item-name").value.trim();
            const itemQuantity = document.getElementById("item-quantity").value.trim();

            if (itemName === "" || itemQuantity === "" || itemQuantity <= 0) {
                alert("Please enter a valid item name and quantity.");
                return;
            }

            // Add item to order array
            const newItem = { name: itemName, quantity: itemQuantity };
            orderItems.push(newItem);
            updateTable();

            // Clear input fields after adding item
            document.getElementById("item-name").value = "";
            document.getElementById("item-quantity").value = "";
        });

        function updateTable() {
            const orderTableBody = document.getElementById("order-items");
            orderTableBody.innerHTML = "";

            orderItems.forEach((item, index) => {
                const row = `
                    <tr class="border-b">
                        <td class="px-1 py-1 text-center">${index + 1}</td>
                        <td class="px-1 py-1">${item.name}</td>
                        <td class="px-1 py-1 text-center">${item.quantity}</td>
                        <td class="px-1 py-1 text-center">
                            <button class="bg-red-500 text-white px-2 py-1 text-xs rounded-md remove-item" data-index="${index}">
                                Remove
                            </button>
                        </td>
                    </tr>
                `;
                orderTableBody.insertAdjacentHTML("beforeend", row);
            });

            // Show table if items exist
            orderTable.classList.toggle("hidden", orderItems.length === 0);

            // Update hidden input field with order items
            orderItemsInput.value = JSON.stringify(orderItems);

            // Attach event listeners to remove buttons
            document.querySelectorAll(".remove-item").forEach(button => {
                button.addEventListener("click", function () {
                    const index = this.dataset.index;
                    orderItems.splice(index, 1);
                    updateTable();
                });
            });
        }

        // Prevent submission if no items are added
        document.getElementById("order-form").addEventListener("submit", function (event) {
            if (orderItems.length === 0) {
                alert("Please add at least one item to place an order.");
                event.preventDefault();
            }
        });
    });
</script>

{% endblock %}
